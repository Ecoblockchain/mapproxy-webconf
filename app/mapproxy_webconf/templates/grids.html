%def leftblock():
  <div ng-controller="MapproxyGridListCtrl">
    <button class="btn btn-small btn-info pull-right" ng-click="newGrid()">
      <span class="icon-plus-sign icon-white" ></span>
      {{'Create new grid'|i18n}}</button>

    <h3>{{'User defined grids'|i18n}}</h3>
    <span message-handler="success" message-types="grids.delete_success"></span>
    <span message-handler="error" message-types="grids.load_error,grids.delete_error"></span>
    <div>
      <input type="text" ng-model="search" placeholder="{{'Filter'|i18n}}..."/>
      <br>
      <span ng-show="mapproxy_grids.length - filtered.length" ng-click="search=''">{{'Not shown grids'|i18n}}: {{mapproxy_grids.length - filtered.length}}</span>
    </div>
    <ul class="vertical-list">
       <div class="{{isSelected(grid)}}" ng-repeat="grid in filtered = (mapproxy_grids | filter: {data.name:search}) | orderBy:'name'"
        ng-click="editGrid(grid)">
         <li>
          <i ng-show="grid._manual" class="icon-pencil"></i>
          {{grid.data.name}}
          <i ng-show="!hasDependencies(grid)" class="icon-remove"
            dialog="ask"
            dialog-title="{{'Confirm!'|i18n}}"
            dialog-text="{{'Really remove grid:'|i18n}} {{grid.data.name}}?"
            callback="removeGrid(grid)">
          </i>
          <i ng-show="hasDependencies(grid)" class="icon-remove"
            dialog="confirm"
            dialog-width="600"
            dialog-height="300"
            dialog-title="Confirm!"
            dialog-text="{{'Can not remove grid:'|i18n}} {{grid.data.name}}<br>{{'Dependencies are:'|i18n}}<br>{{getDependencies(grid)}}">
          </i>
        </li>
      </div>
    </ul>
    <h3>{{'Locked grids'|i18n}}</h3>
    <div>
      <input type="text" ng-model="search_locked" placeholder="{{'Filter'|i18n}}..."/>
      <br>
      <span ng-show="locked_grids.length - filtered_locked.length" ng-click="search_locked=''">{{'Not shown grids'|i18n}}: {{locked_grids.length - filtered_locked.length}}</span>
    </div>
    <ul class="vertical-list">
       <div class="{{isSelected(grid)}}" ng-repeat="grid in filtered_locked = (locked_grids | filter: {data.name:search_locked}) | orderBy:'name'"
        ng-click="editGrid(grid)">
         <li>
          <i ng-show="grid._manual" class="icon-pencil"></i>
          {{grid.data.name}}
        </li>
      </div>
    </ul>


    <h3>{{'Default grids'|i18n}}</h3>
     <ul class="vertical-list">
       <div class="{{isSelected(grid)}}" ng-repeat="grid in default_grids | orderBy:'name'"
        ng-click="editGrid(grid)">
         <li>{{grid.data.name}}
        </li>
      </div>
    </ul>
    <span ng-show="false">{{filtered.length}}</span>
  </div>
%end

%def middleblock():
<div ng-controller="MapproxyGridFormCtrl">
  <div ng-show="!editareaBinds.visible">
    <h3>{{formTitle|i18n}}</h3>
    <form name="grid_form" id="grid_form" ng-show="!grid.default&&!grid._locked" novalidate>
      <!-- name -->
      <div labeled="input_label" name-for="grid_form.name" text="{{'Name'|i18n}}">
          <input required type="text" ng-model="grid.data.name" id="grid_form.name" />
      </div>
      <!-- SRS -->
      <div labeled="input_label" name-for="grid_form.srs" text="{{'SRS'|i18n}}">
           <select ng-model="grid.data.srs" id="grid_form.srs" ng-options="srs for srs in defaults.data.srs">
          </select>
      </div>
      <!-- BBox -->
      <div labeled="input_label" name-for="grid_form.bbox_0" text="{{'BBox'|i18n}}">
          <input type="number" ng-model="grid.data.bbox[0]" class="input-mini" id="grid_form.bbox_0" />
          <input type="number" ng-model="grid.data.bbox[1]" class="input-mini" id="grid_form.bbox_1" />
          <input type="number" ng-model="grid.data.bbox[2]" class="input-mini" id="grid_form.bbox_2" />
          <input type="number" ng-model="grid.data.bbox[3]" class="input-mini" id="grid_form.bbox_3" />
      </div>
      <!-- BBox SRS -->
      <div labeled="input_label" name-for="grid_form.bbox_srs" text="{{'BBox SRS'|i18n}}">
          <select ng-model="grid.data.bbox_srs" id="grid_form.bbox_srs" ng-options="srs for srs in defaults.data.srs">
          </select>
      </div>
      <!-- origin -->
      <div labeled="input_label" name-for="grid_form.origin" text="{{'Origin'|i18n}}">
          <select ng-model="grid.data.origin" id="grid_form.origin">
              <option value="sw">SW / LL</option>
              <option value="nw">NW / UL</option>
          </select>
      </div>
      <div class="text-center">
        <span id="_editarea_toggle_button_container"></span>
        <button class="btn btn-small" ng-click="addGrid($event)" ng-disabled="!grid_form.$valid" id="grid_form_save">{{'Save'|i18n}}</button>
        <button
          class="btn btn-small"
          dialog="ask"
          dialog-title="{{'Really lock the grid'|i18n}}: {{grid.data.name}}?"
          dialog-text="{{'If you lock the grid, you won\'t be able to edit it again'|i18n}}"
          callback="lockGrid()"
          ng-disabled="!grid_form.$valid"
          id="grid_form_lock">{{'Save and lock'|i18n}}
        </button>
        <button class="btn btn-small" ng-click="resetForm($event)">{{'Reset'|i18n}}</button>
      </div>
    </form>
  </div>
  <div ng-show="grid._locked">
    <div labeled="input_label" name-for="locked_grid.name" text="{{'Name'|i18n}}">
      <div class="input-xlarge" id="locked_grid.name">{{grid.data.name}}</div>
    </div>
    <div labeled="input_label" name-for="locked_grid.srs" text="{{'SRS'|i18n}}">
      <div class="input-xlarge" id="locked_grid.srs">{{grid.data.srs}}</div>
    </div>
    <div labeled="input_label" name-for="locked_grid.bbox" text="{{'BBox'|i18n}}">
      <div class="input-xlarge" id="locked_grid.bbox">{{grid.data.bbox[0]}}</div>
      <div class="input-xlarge" id="locked_grid.bbox">{{grid.data.bbox[1]}}</div>
      <div class="input-xlarge" id="locked_grid.bbox">{{grid.data.bbox[2]}}</div>
      <div class="input-xlarge" id="locked_grid.bbox">{{grid.data.bbox[3]}}</div>
    </div>
    <div labeled="input_label" name-for="locked_grid.bbox_srs" text="{{'BBox SRS'|i18n}}">
      <div class="input-xlarge" id="locked_grid.bbox_srs">{{grid.data.bbox_srs}}</div>
    </div>
    <div labeled="input_label" name-for="locked_grid.origin" text="{{'Origin'|i18n}}">
      <div class="input-xlarge" id="locked_grid.origin">{{grid.data.origin}}</div>
    </div>
  </div>
  <div ng-show="grid.default">
    <div labeled="input_label" name-for="default_grid.name" text="{{'Name'|i18n}}">
      <div class="input-xlarge" id="default_grid.name">{{grid.data.name}}</div>
    </div>
  </div>
  <div editarea="editareaBinds" yaml-URL="/yaml" json-URL="/json" keep-empty-fields="name"></div>
  <div class="text-center">
    <span message-handler="success" message-types="grids.add_success,grids.update_success"></span>
    <span message-handler="error" message-types="grids.add_error,grids.update_error,grids.form_error"></span>
  </div>
</div>
%end

%def rightblock():
&nbsp;
%end

%rebase base_config leftblock=leftblock, middleblock=middleblock, rightblock=rightblock, project=get('project'), active='grids'
<!doctype html>
<html xmlns:ng="http://angularjs.org" ng-app="mapproxy_gui">
  <head>
    <title>Mapproxy GUI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="${ get_url('static', filepath='css/openlayers.css') }">
    <link rel="stylesheet" href="${ get_url('static', filepath='css/toolbar.css') }">
    <link rel="stylesheet" href="${ get_url('static', filepath='css/bootstrap.css') }">
    <link rel="stylesheet" href="${ get_url('static', filepath='css/bootstrap-responsive.css') }">
    <link rel="stylesheet" href="${ get_url('static', filepath='css/jquery-ui-1.10.0.bootstrap.css') }">
    <link rel="stylesheet" href="${ get_url('static', filepath='css/jquery-ui.css') }">

    <link rel="stylesheet" href="${ get_url('static', filepath='css/custom.css') }">
    % if defined('css'):
      %css()
    % end

    % if defined('preload_block') and hasattr(preload_block, '__call__'):
      <script type="text/javascript">
        %preload_block()
      </script>
    %end

    <!--[if lte IE 8]>
      <script type="text/javascript" src="${ get_url('static', filepath='js/ie8_fixtures.js')}"></script>
    <![endif]-->

    <!-- libs -->
    <script type="text/javascript" src="${ get_url('static', filepath='js/lib/jquery-1.9.1.min.js') }"></script>
    <script type="text/javascript" src="${ get_url('static', filepath='js/lib/jquery-ui-1.10.3.custom.min.js') }"></script>
    <script type="text/javascript" src="${ get_url('static', filepath='js/lib/jquery.blockUI.js') }"></script>
    <script type="text/javascript" src="${ get_url('static', filepath='js/lib/angular.js') }"></script>
    <script type="text/javascript" src="${ get_url('static', filepath='js/lib/angular-locale_de-de.js') }"></script>
    <script type="text/javascript" src="${ get_url('static', filepath='js/lib/angular.extensions.js') }"></script>
    <script type="text/javascript" src="${ get_url('static', filepath='js/lib/angular-resource.js') }"></script>
    <script type="text/javascript" src="${ get_url('static', filepath='js/lib/bootstrap.js') }"></script>
    <script type="text/javascript" src="${ get_url('static', filepath='js/lib/OpenLayers-2.13.min.custom.js') }"></script>
    <script type="text/javascript" src="${ get_url('static', filepath='js/openlayers.extensions/delete.js') }"></script>
    <script type="text/javascript" src="${ get_url('static', filepath='js/openlayers.extensions/string.format.js') }"></script>

    <!-- site libs -->
    <script type="text/javascript" src="${ get_url('static', filepath='js/mapproxy_gui.js') }"></script>
    <script type="text/javascript">
      include_requireds("${ get_url('static', filepath='js/') }")
    </script>
    % if defined('jsblock') and hasattr(jsblock, '__call__'):
      %jsblock()
    %end
    <script type="text/javascript">
      /* overwrite styling from block ui for openlayers map*/
      $.blockUI.defaults.overlayCSS = {};
      $.blockUI.defaults.css = {};

      /* Set OpenLayers ImgPath */
        OpenLayers.ImgPath = "${ get_url('static', filepath='img/') }";

      /* add directives and services*/
        var app = angular.module('mapproxy_gui', ['angular.extensions', 'mapproxy_gui.directives', 'mapproxy_gui.services', 'mapproxy_gui.validators', 'mapproxy_gui.messages', 'mapproxy_gui.tooltips', 'mapproxy_gui.openlayers']);

      /* app defaults */
        app.value('PAGE_LEAVE_MSG', PAGE_LEAVE_MSG);
        app.value('SRS', SRS);
        app.value('NON_TRANSPARENT_FORMATS', NON_TRANSPARENT_FORMATS);
        app.value('BACKGROUND_SERVICE_TITLE', BACKGROUND_SERVICE_TITLE);
        app.value('BACKGROUND_SERVICE_URL', BACKGROUND_SERVICE_URL);
        app.value('BACKGROUND_SERVICE_LAYER', BACKGROUND_SERVICE_LAYER);
        app.value('MAPPROXY_DEFAULT_GRID_SRS', MAPPROXY_DEFAULT_GRID_SRS);

      /* OpenLayers directive defaults */
        angular.module('mapproxy_gui.openlayers').value('GRID_AS_GEOJSON_URL', "${ get_url('grid_as_geojson') }");
        angular.module('mapproxy_gui.openlayers').value('LAYERSWITCHER_TEMPLATE_URL', "${ get_url('angular_template', filename='layerswitcher') }");
        angular.module('mapproxy_gui.openlayers').value('OPENLAYERSMAP_TEMPLATE_URL', "${ get_url('angular_template', filename='openlayersmap') }");
        angular.module('mapproxy_gui.openlayers').value('DPI', DPI);
        angular.module('mapproxy_gui.openlayers').value('NUM_ZOOM_LEVELS', NUM_ZOOM_LEVELS);
        angular.module('mapproxy_gui.openlayers').value('GRID_START_LEVEL', GRID_START_LEVEL);
        angular.module('mapproxy_gui.openlayers').value('GRID_MAX_LEVEL', GRID_MAX_LEVEL);

      /* Message directive defaults */
        angular.module('mapproxy_gui.messages').value('FADEOUT_DELAY', FADEOUT_DELAY);

      /* Other directive defaults */
        angular.module('mapproxy_gui.directives').value('EDITAREA_TEMPLATE_URL', "${ get_url('angular_template', filename='editarea') }");
        angular.module('mapproxy_gui.directives').value('EXTENDABLE_INPUT_LIST_TEMPLATE_URL', "${ get_url('angular_template', filename='extendable_input_list') }");
        angular.module('mapproxy_gui.directives').value('FADEOUT_DELAY', FADEOUT_DELAY);

        app.run(function($rootScope, tooltipMapper, TranslationService) {
          $rootScope.LANGUAGE = '${ language }';
          % if defined('project') and project != None:
            $rootScope.PROJECT = '${ project }';
          %end
          tooltipMapper.loadDict("${ get_url('resource', filename='tooltips.%s.js' % language) }");
          TranslationService.loadDict("${ get_url('resource', filename='translations.js') }");

        });
     </script>
    %include angular/base_templates
  </head>
  <body>
    <div id="wrapper">
      <div class="navbar navbar-static-top">
        <div class="navbar-inner">
          <div class="container">
            <a class="brand" href="/">MPG</a>
            <ul class="nav">
              <li><a href="${ get_url('projects') }">${ _('Projects') }</a></li>
              %if defined('project') and project != None:
                <li><a href="${ get_url('configuration', project=project) }">${ _('Configuration') }</a></li>
              %end
            </ul>
          </div>
        </div>
      </div><!-- /.navbar -->
      <div class="sitebar-wrapper">
        <div class="shadow"></div>
        <div class="sitebar container">
          % if defined('site_navbar'):
            %site_navbar()
          % end
        </div>
      </div>
      <div class="container content">
        <div class="row-fluid">
          % if defined('content'):
            %content()
          % end
        </div>
      </div>
      <footer>
        &copy; 2013 - Omniscale GmbH & Co. KG
      </footer>
    </div>
  </body>
</html>

%def leftblock():
<div ng-controller="MapproxyCacheListCtrl">
      <h3>Cache</h3>
      <ul>
          <li
              class="mapproxy_cache label"
              ng-repeat="cache in mapproxy_caches | orderBy:'name'"
              ng-click="editCache(cache)">
              {{cache.name}}
              <button
                  class="btn btn-mini btn-danger right"
                  ask-dialog
                  dialog-title="Confirm!"
                  dialog-text='Really remove cache "{{cache.name}}"?'
                  callback="removeCache(cache)">X</button>
          </li>
      </ul>
      <button class="btn btn-small" ng-click="newCache()">New cache</button>
  </div>
%end

%def middleblock():
<div ng-controller="MapproxyCacheFormCtrl">
    <form name="cache_form" ng-model="cache" class="form-horizontal">
        <h3>{{formTitle}}</h3>
    <!-- name -->
        <div labeled-control-group name-for="cache_form.cache_name" text="Name">
            <input required type="text" ng-model="cache.name" name="cache_form.cache_name"/>
        </div>
    <!-- sources -->
        <!-- change-callback MUST provide parameters callback and new_data -->
        <div labeled-control-group name-for="cache_form.sources" text="Sources">
            <div
                droppable
                required
                accepts="mapproxy_source"
                allow-array="true"
                ng-model="cache.sources"
                name="cache_form.sources"
                use-key-for-value="_id"
                class="insertable_multi uneditable-input">
                <div sortable ng-model="cache.sources" >
                    <div ng-repeat="source in cache.sources" class="item">
                        <span ng-bind="showName(source)"></span>
                        <button class="btn btn-mini btn-danger right" ng-click="remove(source)">X</button>
                    </div>
                </div>
            </div>
        </div>
    <!-- grids XXXkai: replace by received list of supported srs combined with user defined grids-->
        <div labeled-control-group name-for="cache_form.grids" text="Grids">
            <select ng-model="cache.grids" name="cache_form.grids" multiple="multiple" ng-options="value._id as value.name for value in available_grids"/>
            </select>
        </div>
    </form>
    <button class="btn btn-small" ng-click="addCache($event)" ng-disabled="!cache_form.$valid">Save</button>
    <i id="cache_save_ok" class="icon-ok" ng-show="false"></i>
    <button class="btn btn-small" ng-click="resetForm($event)">Reset</button>
</div>
%end

%def rightblock():
<div ng-controller="MapproxySourceListCtrl">
    <h3>Sources</h3>
    <ul>
        <li
            draggable
            class="mapproxy_source label"
            ng-repeat="source in mapproxy_sources | orderBy:'name'"
            item-data="{{source}}">
            {{source.name}}
        </li>
    </ul>
</div>
%end

%rebase base_config leftblock=leftblock, rightblock=rightblock, middleblock=middleblock,  project=get('project'), active='caches'